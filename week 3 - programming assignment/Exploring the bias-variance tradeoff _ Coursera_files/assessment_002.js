define("bundles/assess/assessmentTypes/phoenixQuiz/assessment.header",["require","exports","module","moment","underscore","bundles/assess/assessmentTypes/phoenixQuiz/assessment.examHeader.html","bundles/assess/assessmentTypes/phoenixQuiz/assessment.quizHeader.html","bundles/payments-common/components/ReactPriceDisplay","bundles/payments/promises/productPrices","bundles/phoenix/lib/view","bundles/ondemand/components/endOfCourse/components/CourseCompleteModal","js/lib/imgix","js/lib/pluralize","js/lib/pluralizer","pages/open-course/common/constants","pages/open-course/common/views/performanceBar"],function(require,exports,module){"use strict";var d=require("moment"),_=require("underscore"),o=require("bundles/assess/assessmentTypes/phoenixQuiz/assessment.examHeader.html"),t=require("bundles/assess/assessmentTypes/phoenixQuiz/assessment.quizHeader.html"),i=require("bundles/payments-common/components/ReactPriceDisplay"),n=require("bundles/payments/promises/productPrices"),a=require("bundles/phoenix/lib/view"),s=require("bundles/ondemand/components/endOfCourse/components/CourseCompleteModal"),r=require("js/lib/imgix"),l=require("js/lib/pluralize"),m=require("js/lib/pluralizer"),e=require("pages/open-course/common/constants"),u=require("pages/open-course/common/views/performanceBar"),h=a.extend({stateModelProperty:"model",initialize:function initialize(s){_(this).extend(_(s).pick("metadata","nextItem","courseMaterials","verificationDisplay")),this.learnerStoryImg=r.processImage(e.vcLandingLearnerPhoto,{height:68}),this.landingPagePath=e.vcLandingPagePath,this.initializeEvents(),this.initializeSubViews(),this.initializePluralizer(),this.moment=d},initializeSubViews:function initializeSubViews(){"exam"!==this.metadata.getTypeName()&&(this.performanceBar=new u({evaluation:this.model.get("evaluation"),showValue:!1}))},initializePluralizer:function initializePluralizer(){this.pluralize=l,this.pluralizer=new m(this.$el),this.pluralizer.setRules({"num-questions":{model:this.model,property:"questionInstances",converter:_.property("length")}})},initializeEvents:function initializeEvents(){this.listenTo(this.model,"question:added",this.renderMetadata),this.listenTo(this.model,"change:state",this.renderState),this.listenTo(this.model,"state:enter:submitted",this.renderEvaluation)},template:function template(e){return"exam"===this.metadata.getTypeName()?o(e):t(e)},renderSubviews:function renderSubviews(){this.performanceBar&&this.$$("performance-bar-container").html(this.performanceBar.render().el)},renderCourseCompleteModal:function renderCourseCompleteModal(){this.renderReactInto(s,"CourseCompleteModal",{})},renderEvaluation:function renderEvaluation(){"exam"===this.metadata.getTypeName()?this.renderExamEvaluation():this.renderQuizEvaluation()},renderMetadata:function renderMetadata(){this.$$("num-questions-label").html(this.model.get("questionInstances").length)},renderQuizEvaluation:function renderQuizEvaluation(){var e=this.model.get("evaluation");if(!e)return;var s=e.isPassed(),t=this.$$(s?"next-button":"retake-button"),i=this.$$(s?"retake-button":"next-button"),n=this.$$(s?"passed-label":"not-passed-label"),a=this.$$(s?"not-passed-label":"passed-label");s?this.$$("performance-bar-container").removeClass("c-performance-bar-dim"):this.$$("performance-bar-container").addClass("c-performance-bar-dim"),t.removeClass("c-btn-white").addClass("bt3-btn-success"),i.removeClass("bt3-btn-success").addClass("c-btn-white"),n.show(),a.hide(),this.$$("num-questions-correct-label").html(e.get("score")),this.$$("num-questions-label").html(e.get("maxScore")),this.$$("num-questions-required-label").html(e.getPassingQuestionCount())},renderExamEvaluation:function renderExamEvaluation(){var s=this.model.get("evaluation"),t=this.model.get("gradingAttempt"),r=t.get("attemptState");if(!s)return;var a=s.isPassed(),l=a?"passed":"not-passed";a?this.$$("exam-header").removeClass("c-exam-not-passed").addClass("c-exam-passed"):this.$$("exam-header").removeClass("c-exam-passed").addClass("c-exam-not-passed"),this.$("[data-passing-state]").hide(),this.$('[data-passing-state~="'+l+'"]').show();var o=void 0,e={none:"none",unverified:"unverified",pending:"pending"};if(this.verificationDisplay.shouldPromptForVerification()&&a){var m=_([[t.attemptStates.none,e.none],[t.attemptStates.unverified,e.unverified],[t.attemptStates.pending,e.pending],[t.attemptStates.verified,e.none]]).object();o=m[r]}else o=e.none;this.$("[data-verification-warning]").hide(),this.$('[data-verification-warning~="'+o+'"]').show(),o===e.none?this.$$("exam-header").removeClass("c-exam-verification-warning"):this.$$("exam-header").addClass("c-exam-verification-warning"),this.$$("num-questions-required-label").html(s.getPassingQuestionCount()),this.$$("num-questions-correct-label").html(s.get("score")),this.$$("num-questions-label").html(s.get("maxScore")),this.verificationDisplay.showCCAdvertising()&&a&&(this.$$("vc-upsell").show(),n.getPriceForVC({courseId:this.metadata.get("course").get("id")}).then(function(e){this.renderReactInto(i,"ReactPriceDisplay",{value:e.getDisplayAmount(),currency:e.getDisplayCurrencyCode()})}.bind(this)).fail(function(e){if(!e.responseJSON)throw e}).done()),this.renderCourseCompleteModal()}});module.exports=h});